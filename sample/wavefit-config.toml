run = "run1"
dirname = "wavetool-field"
profile = "data/profile.msgpack"
overwrite = true

# Wavefit runtime mode is controlled by CLI flags, not TOML:
# - normal run: analyzes all snapshots in wavefile
# - --debug: analyzes only a subset (via --debug-count/--debug-mode/--debug-index)
# - quicklook control in debug mode is also CLI-only
#   (--debug-plot/--no-debug-plot/--debug-plot-count/--debug-plot-prefix)
#
# Example:
#   python -m shock.wavefit -j analyze sample/wavefit-config.toml
#   python -m shock.wavefit -j analyze --debug --debug-count 4 sample/wavefit-config.toml
#   python -m shock.wavefit -j analyze --debug --debug-index 0 --debug-index 8 sample/wavefit-config.toml

[analyze]
wavefile = "wavefilter"
# Optional source for local background context (raw B and J)
rawfile = "wavetool"
fitfile = "wavefit"

# Gaussian window radius for fit patch (physical units: c/omega_pe)
sigma = 4.0

# Spatial smoothing of E/B fields before fitting (physical units: c/omega_pe)
# Set to 0 to disable smoothing.
smooth_sigma = 0.5

# Candidate selection from |B| envelope normalized by B0
# envelope_threshold is an absolute threshold on |B_wave| / B0
# B0 is computed from profile parameters (sigma, u0)
# candidate_distance is the minimum candidate spacing (physical units)
# envelope_smooth_sigma smooths the envelope before peak detection (physical units)
# max_candidates is used only when running with --debug
max_candidates = 32
envelope_smooth_sigma = 0.5
envelope_threshold = 0.10
candidate_distance = 4.0

# Fit region around each candidate is fixed to 3*sigma
fit_min_points = 64

# Circular-wave fit bounds/initial values
kx_init = 0.30
kx_min = 0.10
kx_max = 2.00
ky_init = 0.00
ky_abs_max = 1.00

# Optional multi-start seeds (multi-start is always enabled)
# If omitted, internal defaults are used.
kx_init_scan = [0.1, 0.3, 0.6]
ky_init_scan = [-0.8, -0.4, 0.0, 0.4, 0.8]

# Quality gates (fits are still stored even if low_quality)
# good_nrmse_bal_max: lower is stricter
# good_lambda_factor_max: requires wavelength <= factor * sigma
good_nrmse_bal_max = 0.40
good_lambda_factor_max = 4.0

# Diagnostic plot behavior is controlled by CLI flags.

[plot]
wavefile = "wavefilter"
fitfile = "wavefit"
# Output: <fitfile>-envelope-<index>.png under work/<run>/<dirname>/
